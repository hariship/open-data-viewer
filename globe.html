<!DOCTYPE html>
<html>
<head>
    <title>Cesium Globe</title>
    <script src="config.js"></script>
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.100/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.100/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    <style>
        body { margin: 0; padding: 0; }
        #cesiumContainer { width: 100%; height: 100vh; }
        #infoPanel {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 5px;
            border-radius: 5px;
            font-size: 12px; /* Smaller font size */
            max-width: 150px; /* Maximum width */
            overflow: hidden; /* Hide overflow */
            box-shadow: 0 2px 6px rgba(0,0,0,0.3); /* Optional: adds subtle shadow */
            border: 1px solid #ddd; /* Optional: adds border */
        }
    </style>
</head>
<body>
    <div id="cesiumContainer"></div>
    <div id="infoPanel">Click on the globe to add a pin.</div>

    <script>
        // Your access token from Cesium ion
        Cesium.Ion.defaultAccessToken = cesiumAccessToken;

        // Initializing the Cesium Viewer in the div with the id 'cesiumContainer'.
        let viewer = new Cesium.Viewer('cesiumContainer', {
            terrainProvider: Cesium.createWorldTerrain(),
            animation: false,         // Disable the animation widget
            timeline: false,          // Disable the timeline widget
            skyBox: false,            // Disable the skyBox (for stars)
            homeButton: false,        // Disable the home button
            geocoder: false,          // Disable the geocoder widget
            fullscreenButton: false,  // Disable the full screen button
            vrButton: false,          // Disable the VR button
            baseLayerPicker: false    // Disable the base layer picker
        });

        function addPin(longitude, latitude) {
            let id = 'pin_' + longitude + '_' + latitude; // Generate a unique ID for the pin
            viewer.entities.add({
                id: id,
                position: Cesium.Cartesian3.fromDegrees(longitude, latitude),
                billboard: {
                    image: 'static/pin.png', 
                    width: 32,
                    height: 32,
                    crossOrigin: 'anonymous'
                },
                properties: {
                    population: '12345', 
                    healthIndex: 'Good'
                }
            });
        }

        let handler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);
        handler.setInputAction(function (movement) {
            let pickedObject = viewer.scene.pick(movement.endPosition);
            if (Cesium.defined(pickedObject)) {
                let entity = pickedObject.id;
                if (entity && entity.properties) {
                    infoPanel.style.display = 'block';
                    infoPanel.innerHTML = 'Chennai<br>Population count: ' +
                                        // entity.properties.population.getValue() +
                                        '<br>Health index: ' 
                                        // entity.properties.healthIndex.getValue();
                    infoPanel.style.bottom = (viewer.canvas.clientHeight - movement.endPosition.y) + 'px';
                    infoPanel.style.left = movement.endPosition.x + 'px';
                }
            } else {
                infoPanel.style.display = 'none';
            }
        }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);

        handler.setInputAction(function (click) {
            let ellipsoid = viewer.scene.globe.ellipsoid;
            let cartesian = viewer.camera.pickEllipsoid(click.position, ellipsoid);
            if (cartesian) {
                let cartographic = ellipsoid.cartesianToCartographic(cartesian);
                let longitude = Cesium.Math.toDegrees(cartographic.longitude);
                let latitude = Cesium.Math.toDegrees(cartographic.latitude);
                
                addPin(longitude, latitude); // This will add a pin where you click
            }
        }, Cesium.ScreenSpaceEventType.LEFT_CLICK);
    </script>
</body>
</html>
